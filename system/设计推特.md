# 设计twitter

设计朋友圈、微博

## 场景分析Senario

功能：

1. 发推，发帖
2. 获取自己和关注的人的帖子
3. 关注某人
4. 取关某人

## 服务分析 Service

拆成两个服务，用户服务和帖子服务

### 用户服务

用户有关注和取关别人的功能

### 帖子服务

发帖功能

获取某人和关注的人最近的帖子

## 存储分析 Storage

用户关注关系 存储到 set集合（或hashTable），同时记录`关注了谁`和`被谁关注`两个集合

每个用户的发帖记录 存储到 链表（或zset）

每个用户的最新帖子列表用大顶堆（按发帖时间倒序），堆元素为帖子（帖子id, 发帖人id, 发帖时间）；

维护最新帖子列表：

- 当用户发帖时，帖子加入到大顶堆；当用户删帖时，记录帖子被删除状态；
- 当用户关注某人时，将此人的帖子加入到大顶堆；
- 拉取最新帖子列表时，判断发帖人是否已经被取关 和 帖子是否已经被删除

## 扩展分析 Scale

为什么明星结婚之类的突发事件，会造成微博挂掉？


